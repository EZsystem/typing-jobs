<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Steve Jobs Speech - Full Practice</title>
<style>
    body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; padding: 30px; background-color: #f0f2f5; color: #333; }
    h1 { color: #444; font-size: 1.6em; margin-bottom: 10px; }
    
    #container { background: white; max-width: 800px; margin: 0 auto; padding: 30px; border-radius: 12px; box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
    
    .controls { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap; }
    select { padding: 10px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; background: #fff; }
    #chapter-select { flex: 2; min-width: 250px; }
    #speed-select { flex: 1; min-width: 120px; }

    #japanese { font-size: 1.1em; color: #555; margin-bottom: 15px; min-height: 1.5em; line-height: 1.6; font-weight: bold; }
    #english-display { font-size: 1.5em; font-weight: bold; margin-bottom: 25px; letter-spacing: 0.5px; min-height: 1.5em; color: #222; }
    
    #input-area { width: 90%; padding: 15px; font-size: 1.3em; border: 2px solid #ddd; border-radius: 8px; outline: none; transition: border-color 0.3s; }
    #input-area:focus { border-color: #007bff; }
    
    #status { margin-top: 20px; font-weight: bold; color: #007bff; min-height: 1.5em; }
    
    .btn-group { margin-top: 20px; }
    button { padding: 12px 25px; font-size: 1.1em; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; transition: background 0.3s; }
    button:hover { background-color: #0056b3; }
    
    .correct { color: #28a745; }
    .incorrect { color: #dc3545; }
    
    .progress-bar { height: 8px; background: #eee; width: 100%; margin-top: 25px; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: #28a745; width: 0%; transition: width 0.3s; }
</style>
</head>
<body>

<div id="container">
    <h1>Steve Jobs Speech Typing</h1>
    
    <div class="controls">
        <select id="chapter-select">
            <option value="all">★ 全文を通して実行 (Full Story)</option>
            <option value="0">1. ひとつ目は点と点をつなぐ話</option>
            <option value="1">2. 私の人生の始まり</option>
            <option value="2">3. 大学中退を決断した</option>
            <option value="3">4. 好奇心と直感に従って出合ったもの</option>
            <option value="4">5. 10年後によみがえった記憶</option>
            <option value="5">6. 点と点がやがてつながると信じよう</option>
            <option value="6">7. ふたつ目は愛と失意の話</option>
            <option value="7">8. 失敗しても自分の仕事を愛していた</option>
            <option value="8">9. アップル追放は人生最良の出来事だった</option>
            <option value="9">10. 愛せる仕事を見つけよう</option>
            <option value="10">11. みっつ目は死に関する話</option>
            <option value="11">12. がんで死の宣告を受けた</option>
            <option value="12">13. 死に近づいた経験から言えること</option>
            <option value="13">14. 自分の心と直感に従う勇気を持て</option>
            <option value="14">15. 『全地球カタログ』に触れて</option>
            <option value="15">16. ハングリーであり続けろ、愚か者であり続けろ</option>
        </select>

        <select id="speed-select">
            <option value="0.5" selected>速度: 0.5 (Slow)</option>
            <option value="0.7">速度: 0.7</option>
            <option value="0.8">速度: 0.8</option>
            <option value="1.0">速度: 1.0 (Normal)</option>
        </select>
    </div>

    <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

    <div id="japanese">テーマを選択してスタートしてください</div>
    <div id="english-display">Stay Hungry. Stay Foolish.</div>
    
    <input type="text" id="input-area" placeholder="Type here..." disabled autocomplete="off">
    
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    <div id="status"></div>
    
    <div class="btn-group">
        <button id="start-btn" onclick="startPractice()">スタート (Start)</button>
    </div>
</div>

<script>
    /* データ構成: 朝日出版社の対訳等の構成を参考に、
       ユーザ指定の16テーマに分類しています。
    */
    const speechData = [
        // 1. 点と点の話
        [
            { en: "I am honored to be with you today", ja: "本日は、皆さんとご一緒できて光栄です、" },
            { en: "for your commencement from one of the finest universities in the world.", ja: "世界でも有数の大学の卒業式に。" },
            { en: "Truth be told, I never graduated from college.", ja: "実を言うと、私は大学を卒業していません。" },
            { en: "And this is the closest I've ever gotten to a college graduation.", ja: "これが私にとって、大学卒業に最も近い経験になります。" },
            { en: "Today I want to tell you three stories from my life.", ja: "本日は、私の人生から3つの話をさせていただきたいと思います。" },
            { en: "That's it. No big deal. Just three stories.", ja: "それだけです。大したことではありません。たった3つの話です。" },
            { en: "The first story is about connecting the dots.", ja: "1つ目は、点と点をつなぐという話です。" }
        ],
        // 2. 人生の始まり
        [
            { en: "I dropped out of Reed College after the first 6 months,", ja: "私はリード大学を最初の半年で退学しました。" },
            { en: "but then stayed around as a drop-in for another 18 months", ja: "しかしその後も、もぐりの学生として18ヶ月ほど居座りました、" },
            { en: "before I really quit. So why did I drop out?", ja: "本当に辞めてしまうまで。ではなぜ、私は中退したのでしょうか？" },
            { en: "It started before I was born.", ja: "話は、私が生まれる前にさかのぼります。" },
            { en: "My biological mother was a young, unwed college graduate student,", ja: "私の生みの母は、若き未婚の大学院生でした。" },
            { en: "and she decided to put me up for adoption.", ja: "彼女は私を養子に出すことに決めました。" },
            { en: "She felt very strongly that I should be adopted by college graduates.", ja: "彼女は、私が大卒の家庭に引き取られるべきだと強く望んでいました。" }
        ],
        // 3. 中退の決断
        [
            { en: "Seventeen years later I did go to college.", ja: "17年後、私は本当に大学に行きました。" },
            { en: "But I naively chose a college that was almost as expensive as Stanford,", ja: "しかし私は何も考えずに、スタンフォードと同じくらい学費の高い大学を選んでしまいました。" },
            { en: "and all of my working-class parents' savings were being spent on my college tuition.", ja: "労働者階級の私の両親の蓄えはすべて、大学の学費に消えていきました。" },
            { en: "After six months, I couldn't see the value in it.", ja: "半年後、私はそこに価値を見出せなくなりました。" },
            { en: "I didn't know what I wanted to do with my life", ja: "人生で何をしたいのか分かりませんでしたし、" },
            { en: "and I didn't know how college was going to help me figure it out.", ja: "大学がどうやってそれを見つける助けになるのかも分かりませんでした。" },
            { en: "So I decided to drop out and trust that it would all work out OK.", ja: "そこで私は退学を決意し、すべてうまくいくと信じることにしたのです。" }
        ],
        // 4. 好奇心と直感
        [
            { en: "It was pretty scary at the time,", ja: "当時はとても怖かったのですが、" },
            { en: "but looking back it was one of the best decisions I ever made.", ja: "振り返ってみれば、それは人生最良の決断のひとつでした。" },
            { en: "The minute I dropped out I could stop taking the required classes that didn't interest me,", ja: "退学した瞬間に、興味のない必修科目の授業に出る必要がなくなり、" },
            { en: "and begin dropping in on the ones that looked interesting.", ja: "面白そうな授業にだけ顔を出せるようになったからです。" },
            { en: "It wasn't all romantic.", ja: "夢のような生活ばかりではありませんでした。" },
            { en: "I didn't have a dorm room, so I slept on the floor in friends' rooms,", ja: "寮の部屋がなかったので、友人の部屋の床で寝泊まりしました。" },
            { en: "and I walked the 7 miles across town every Sunday night", ja: "毎週日曜の夜には、町を横切って7マイル歩きました、" },
            { en: "to get one good meal a week at the Hare Krishna temple.", ja: "ハーレ・クリシュナ寺院で週に一度のまともな食事にありつくために。" },
            { en: "I loved it. And much of what I stumbled into by following my curiosity and intuition", ja: "それが最高でした。好奇心と直感に従って出くわしたものの多くは、" },
            { en: "turned out to be priceless later on.", ja: "後になって、得難い価値を持つものになったのです。" }
        ],
        // 5. 10年後の記憶
        [
            { en: "Reed College at that time offered perhaps the best calligraphy instruction in the country.", ja: "当時のリード大学は、おそらく国内最高のカリグラフィの授業を提供していました。" },
            { en: "Because I had dropped out and didn't have to take the normal classes,", ja: "私は中退していて普通の授業を取る必要がなかったので、" },
            { en: "I decided to take a calligraphy class to learn how to do this.", ja: "カリグラフィの授業を受けて、それを学ぶことにしました。" },
            { en: "I learned about serif and sans serif typefaces,", ja: "セリフやサンセリフといった書体について学びました。" },
            { en: "It was beautiful, historical, artistically subtle in a way that science can't capture,", ja: "それは美しく、歴史があり、科学では捉えられない繊細な芸術性を持っていて、" },
            { en: "and I found it fascinating.", ja: "私はそれに魅了されました。" },
            { en: "None of this had even a hope of any practical application in my life.", ja: "これらが私の人生で何の役に立つかなど、期待すらしていませんでした。" },
            { en: "But ten years later, when we were designing the first Macintosh computer, it all came back to me.", ja: "しかし10年後、最初のマッキントッシュを設計していたとき、その記憶がすべて蘇ったのです。" },
            { en: "And we designed it all into the Mac.", ja: "そして私たちは、そのすべてをMacに組み込みました。" }
        ],
        // 6. 点と点をつなぐ
        [
            { en: "If I had never dropped in on that single course in college,", ja: "もし私が大学であの授業に潜り込んでいなければ、" },
            { en: "the Mac would have never had multiple typefaces or proportionally spaced fonts.", ja: "Macが複数の書体やプロポーショナルフォントを持つことはなかったでしょう。" },
            { en: "Again, you can't connect the dots looking forward;", ja: "繰り返しになりますが、未来を見て点と点をつなぐことはできません。" },
            { en: "you can only connect them looking backwards.", ja: "過去を振り返って初めて、点をつなぐことができるのです。" },
            { en: "So you have to trust that the dots will somehow connect in your future.", ja: "だから、点と点が将来いつかつながると信じなければなりません。" },
            { en: "You have to trust in something - your gut, destiny, life, karma, whatever.", ja: "何かを信じなければなりません。自分の直感、運命、人生、カルマ、何でもいい。" },
            { en: "This approach has never let me down,", ja: "このやり方で、私は裏切られたことがありませんし、" },
            { en: "and it has made all the difference in my life.", ja: "それが私の人生に大きな違いをもたらしたのです。" }
        ],
        // 7. 愛と失意の話
        [
            { en: "My second story is about love and loss.", ja: "2つ目は、愛と失意に関する話です。" },
            { en: "I was lucky. I found what I loved to do early in life.", ja: "私は幸運でした。人生の早い段階で、自分が愛することを見つけたからです。" },
            { en: "Woz and I started Apple in my parents' garage when I was 20.", ja: "私とウォズは、私が20歳の時に実家のガレージでアップルを創業しました。" },
            { en: "We worked hard, and in 10 years Apple had grown from just the two of us in a garage", ja: "我々は懸命に働き、10年でアップルはガレージの2人きりの会社から、" },
            { en: "into a $2 billion company with over 4000 employees.", ja: "4000人以上の従業員を抱える20億ドル企業に成長しました。" }
        ],
        // 8. 失敗しても仕事を愛していた
        [
            { en: "We had just released our finest creation - the Macintosh - a year earlier,", ja: "私たちは最高の作品、マッキントッシュをその1年前に発表したばかりで、" },
            { en: "and I had just turned 30. And then I got fired.", ja: "私は30歳になったばかりでした。そして私はクビになりました。" },
            { en: "How can you get fired from a company you started?", ja: "自分が創業した会社を、どうやったらクビになるのか？" },
            { en: "What had been the focus of my entire adult life was gone,", ja: "私の大人の人生のすべてを賭けてきたものが消え去り、" },
            { en: "and it was devastating.", ja: "私は打ちのめされました。" },
            { en: "I really didn't know what to do for a few months.", ja: "数ヶ月間、本当に何をすべきか分かりませんでした。" },
            { en: "But something slowly began to dawn on me.", ja: "しかし、何かがゆっくりと私の中で明らかになってきました。" },
            { en: "I still loved what I did.", ja: "私はまだ、自分の仕事を愛していたのです。" },
            { en: "The turn of events at Apple had not changed that one bit.", ja: "アップルでの出来事は、そのことを少しも変えませんでした。" },
            { en: "I had been rejected, but I was still in love.", ja: "私は拒絶されましたが、まだ愛していたのです。" },
            { en: "And so I decided to start over.", ja: "だから私は、もう一度やり直すことに決めました。" }
        ],
        // 9. アップル追放は最良の出来事
        [
            { en: "I didn't see it then,", ja: "その時は分かりませんでしたが、" },
            { en: "but it turned out that getting fired from Apple", ja: "アップルをクビになったことは、" },
            { en: "was the best thing that could have ever happened to me.", ja: "私の人生で起こり得た最良の出来事だったと判明したのです。" },
            { en: "The heaviness of being successful was replaced", ja: "成功者であることの重みが、置き換えられました。" },
            { en: "by the lightness of being a beginner again, less sure about everything.", ja: "再び初心者となり、あらゆる物事に確信を持たない軽やかさに。" },
            { en: "It freed me to enter one of the most creative periods of my life.", ja: "おかげで私は解放され、人生で最も創造的な時期のひとつに入ることができました。" },
            { en: "During the next five years, I started a company named NeXT, another company named Pixar,", ja: "続く5年の間に、私はNeXTという会社と、ピクサーという別の会社を立ち上げ、" },
            { en: "and fell in love with an amazing woman who would become my wife.", ja: "後に妻となる素晴らしい女性と恋に落ちました。" }
        ],
        // 10. 愛せる仕事を見つけよう
        [
            { en: "I'm pretty sure none of this would have happened if I hadn't been fired from Apple.", ja: "アップルをクビになっていなければ、これらのことは何ひとつ起こらなかったと確信しています。" },
            { en: "It was awful tasting medicine, but I guess the patient needed it.", ja: "ひどく苦い薬でしたが、患者にはそれが必要だったのでしょう。" },
            { en: "Sometimes life hits you in the head with a brick. Don't lose faith.", ja: "時として人生はレンガで頭を殴りつけてきます。信念を失わないでください。" },
            { en: "I'm convinced that the only thing that kept me going was that I loved what I did.", ja: "私が前進し続けられた唯一の理由は、自分の仕事を愛していたことだと確信しています。" },
            { en: "You've got to find what you love.", ja: "自分が愛せるものを見つけなければなりません。" },
            { en: "Your work is going to fill a large part of your life,", ja: "仕事は人生の大きな部分を占めることになります。" },
            { en: "and the only way to be truly satisfied is to do what you believe is great work.", ja: "心から満足する唯一の方法は、素晴らしい仕事だと信じることをやることです。" },
            { en: "And the only way to do great work is to love what you do.", ja: "そして素晴らしい仕事をする唯一の方法は、自分がやることを愛することです。" },
            { en: "If you haven't found it yet, keep looking. Don't settle.", ja: "まだ見つかっていないなら、探し続けてください。妥協してはいけません。" }
        ],
        // 11. 3つ目は死に関する話
        [
            { en: "My third story is about death.", ja: "3つ目は、死に関する話です。" },
            { en: "When I was 17, I read a quote that went something like:", ja: "私は17歳のとき、次のような言葉を読みました。" },
            { en: "If you live each day as if it was your last, someday you'll most certainly be right.", ja: "「毎日を人生最後の日であるかのように生きれば、いつか必ずその通りになる」" },
            { en: "It made an impression on me, and since then, for the past 33 years,", ja: "それは私の心に残り、それ以来33年間、" },
            { en: "I have looked in the mirror every morning and asked myself:", ja: "毎朝鏡を見て、自分自身に問いかけてきました。" },
            { en: "If today were the last day of my life,", ja: "「もし今日が人生最後の日だとしたら、" },
            { en: "would I want to do what I am about to do today?", ja: "今日やろうとしていることを、私は本当にやりたいだろうか？」" },
            { en: "And whenever the answer has been 'No' for too many days in a row,", ja: "そして、その答えが「No」である日が何日も続くと、" },
            { en: "I know I need to change something.", ja: "何かを変える必要があると気づくのです。" }
        ],
        // 12. がんで死の宣告
        [
            { en: "About a year ago I was diagnosed with cancer.", ja: "およそ1年前、私は癌と診断されました。" },
            { en: "I had a scan at 7:30 in the morning,", ja: "朝の7時半にスキャンを受けたところ、" },
            { en: "and it clearly showed a tumor on my pancreas.", ja: "膵臓に腫瘍があることがはっきりと写っていました。" },
            { en: "I didn't even know what a pancreas was.", ja: "私は膵臓が何なのかさえ知りませんでした。" },
            { en: "The doctors told me this was almost certainly a type of cancer that is incurable,", ja: "医者は、ほぼ間違いなく治療不可能な種類の癌であり、" },
            { en: "and that I should expect to live no longer than three to six months.", ja: "余命は3ヶ月から6ヶ月だろうと告げました。" },
            { en: "My doctor advised me to go home and get my affairs in order,", ja: "医者は家に帰って身辺整理をするように言いました。" },
            { en: "which is doctor's code for prepare to die.", ja: "それは、死ぬ準備をしろという医者なりの合図なのです。" }
        ],
        // 13. 死に近づいた経験
        [
            { en: "I lived with that diagnosis all day.", ja: "私は一日中、その診断を抱えて過ごしました。" },
            { en: "Later that evening I had a biopsy.", ja: "その日の夕方、生検を受けました。" },
            { en: "They stuck an endoscope down my throat, through my stomach and into my intestines,", ja: "喉から内視鏡を入れ、胃を通って腸に達し、" },
            { en: "put a needle into my pancreas and got a few cells from the tumor.", ja: "膵臓に針を刺して腫瘍から細胞を採取しました。" },
            { en: "I was sedated, but my wife, who was there, told me that", ja: "私は麻酔で眠っていましたが、そこにいた妻が教えてくれました。" },
            { en: "when they viewed the cells under a microscope the doctors started crying", ja: "顕微鏡で細胞を見たとき、医者たちが泣き出したと。" },
            { en: "because it turned out to be a very rare form of pancreatic cancer", ja: "なぜなら、それは非常に稀な種類の膵臓癌で、" },
            { en: "that is curable with surgery. I had the surgery and I'm fine now.", ja: "手術で治せるものだと判明したからです。私は手術を受け、今は元気です。" }
        ],
        // 14. 自分の心と直感
        [
            { en: "No one wants to die.", ja: "死にたい人なんていません。" },
            { en: "And yet death is the destination we all share. No one has ever escaped it.", ja: "それでもなお、死は我々全員が共有する行き先です。誰もそこから逃れることはできません。" },
            { en: "And that is as it should be, because Death is very likely the single best invention of Life.", ja: "そして、そうあるべきなのです。なぜなら死はおそらく、生命にとって最高の発明だからです。" },
            { en: "It is Life's change agent. It clears out the old to make way for the new.", ja: "それは生命の変革を担うものです。古きを取り去り、新しきに道を開くのです。" },
            { en: "Right now the new is you, but someday not too long from now,", ja: "今、新しきは皆さんですが、いつかそれほど遠くない未来に、" },
            { en: "you will gradually become the old and be cleared away.", ja: "皆さんもだんだんと古きものとなり、取り去られることになります。" },
            { en: "Sorry to be so dramatic, but it is quite true.", ja: "劇的で申し訳ありませんが、これは紛れもない真実なのです。" },
            { en: "Your time is limited, so don't waste it living someone else's life.", ja: "時間は限られています。だから、誰かの人生を生きて無駄にしてはいけません。" },
            { en: "Don't be trapped by dogma - which is living with the results of other people's thinking.", ja: "ドグマに囚われてはいけません。それは他人の考えの結果に従って生きることです。" },
            { en: "Have the courage to follow your heart and intuition.", ja: "自分の心と直感に従う勇気を持ってください。" },
            { en: "They somehow already know what you truly want to become.", ja: "それらは、あなたが本当になりたいものをすでによく知っています。" }
        ],
        // 15. 全地球カタログ
        [
            { en: "When I was young, there was an amazing publication called The Whole Earth Catalog,", ja: "私が若かった頃、『全地球カタログ』という素晴らしい出版物がありました。" },
            { en: "which was one of the bibles of my generation.", ja: "それは私の世代のバイブルのひとつでした。" },
            { en: "It was created by a fellow named Stewart Brand not far from here in Menlo Park,", ja: "ここから遠くないメンローパークに住むスチュアート・ブランドという男が作り出し、" },
            { en: "and he brought it to life with his poetic touch.", ja: "詩的なタッチでそれに命を吹き込みました。" },
            { en: "This was in the late 1960's, before personal computers and desktop publishing,", ja: "それは60年代後半、パソコンやDTPが登場する前のことだったので、" },
            { en: "so it was all made with typewriters, scissors, and polaroid cameras.", ja: "すべてタイプライターとハサミ、ポラロイドカメラで作られていました。" },
            { en: "It was sort of like Google in paperback form, 35 years before Google came along:", ja: "それは、グーグルが登場する35年前の、ペーパーバック版グーグルのようなものでした。" },
            { en: "it was idealistic, and overflowing with neat tools and great notions.", ja: "理想に満ちていて、素晴らしいツールや偉大な概念で溢れていました。" }
        ],
        // 16. Stay Hungry. Stay Foolish.
        [
            { en: "Stewart and his team put out several issues of The Whole Earth Catalog,", ja: "スチュアートと彼のチームは『全地球カタログ』を何度か発行し、" },
            { en: "and then when it had run its course, they put out a final issue.", ja: "一通りやり終えたとき、最終号を出しました。" },
            { en: "It was the mid-1970s, and I was your age.", ja: "それは70年代半ばで、私は皆さんと同じ年頃でした。" },
            { en: "On the back cover of their final issue was a photograph of an early morning country road,", ja: "最終号の裏表紙には、早朝の田舎道の写真がありました。" },
            { en: "the kind you might find yourself hitchhiking on if you were so adventurous.", ja: "冒険好きな人なら、ヒッチハイクをするような風景です。" },
            { en: "Beneath it were the words: Stay Hungry. Stay Foolish.", ja: "その下には、こう書かれていました。「ハングリーであれ。愚か者であれ」" },
            { en: "It was their farewell message as they signed off.", ja: "それが、彼らの別れのメッセージでした。" },
            { en: "Stay Hungry. Stay Foolish.", ja: "ハングリーであれ。愚か者であれ。" },
            { en: "And I have always wished that for myself.", ja: "そして私は常に、自分自身そうありたいと願ってきました。" },
            { en: "And now, as you graduate to begin anew, I wish that for you.", ja: "そして今、卒業して新たな始まりを迎える皆さんに、私はそれを願います。" },
            { en: "Stay Hungry. Stay Foolish.", ja: "ハングリーであれ。愚か者であれ。" },
            { en: "Thank you all very much.", ja: "ご清聴ありがとうございました。" }
        ]
    ];

    let currentQueue = [];
    let currentIndex = 0;
    const jaDisplay = document.getElementById('japanese');
    const enDisplay = document.getElementById('english-display');
    const inputArea = document.getElementById('input-area');
    const statusDisplay = document.getElementById('status');
    const startBtn = document.getElementById('start-btn');
    const chapterSelect = document.getElementById('chapter-select');
    const speedSelect = document.getElementById('speed-select');
    const progressFill = document.getElementById('progress-fill');

    function startPractice() {
        const selectedValue = chapterSelect.value;
        currentQueue = [];
        
        if (selectedValue === "all") {
            speechData.forEach(chapter => {
                chapter.forEach(sentence => currentQueue.push(sentence));
            });
        } else {
            const index = parseInt(selectedValue);
            if (speechData[index]) {
                currentQueue = [...speechData[index]];
            }
        }

        if (currentQueue.length === 0) return;

        currentIndex = 0;
        inputArea.disabled = false;
        inputArea.value = "";
        inputArea.focus();
        startBtn.innerText = "リスタート (Restart)";
        updateProgress();
        loadSentence();
    }

    function loadSentence() {
        if (currentIndex >= currentQueue.length) {
            jaDisplay.innerText = "Congratulations! All finished.";
            enDisplay.innerText = "Stay Hungry. Stay Foolish.";
            inputArea.disabled = true;
            statusDisplay.innerText = "Select a theme to start again.";
            progressFill.style.width = "100%";
            return;
        }

        const current = currentQueue[currentIndex];
        jaDisplay.innerText = current.ja;
        enDisplay.innerText = current.en;
        statusDisplay.innerText = "Listening...";
        inputArea.value = "";
        updateProgress();

        // ここで音声再生関数を呼び出し
        speak(current.en, 'en-US');
    }

    // ★修正箇所：読み上げ関数
    function speak(text, lang) {
        // 1. まず前の発話をキャンセルしてリセット
        speechSynthesis.cancel();

        const uttr = new SpeechSynthesisUtterance(text);
        uttr.lang = lang;
        uttr.rate = parseFloat(speedSelect.value);

        uttr.onend = () => {
             statusDisplay.innerText = "Type it!";
        };
        
        // 2. 1.2秒待ってから再生（これにより冒頭切れを防ぐ）
        setTimeout(() => {
            speechSynthesis.speak(uttr);
        }, 1200);
    }

    function updateProgress() {
        const percent = (currentIndex / currentQueue.length) * 100;
        progressFill.style.width = percent + "%";
    }

    inputArea.addEventListener('input', () => {
        if (!currentQueue[currentIndex]) return;
        
        const currentEn = currentQueue[currentIndex].en;
        const userInput = inputArea.value;

        if (userInput === currentEn) {
            statusDisplay.innerText = "Correct! Next...";
            statusDisplay.className = "correct";
            inputArea.disabled = true; 
            setTimeout(() => {
                currentIndex++;
                inputArea.disabled = false;
                inputArea.focus();
                statusDisplay.className = "";
                loadSentence();
            }, 600);
        } else if (currentEn.startsWith(userInput)) {
            statusDisplay.innerText = "Typing...";
            statusDisplay.className = "";
        } else {
            statusDisplay.innerText = "Miss!";
            statusDisplay.className = "incorrect";
        }
    });

    inputArea.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && inputArea.value === '') {
            speak(currentQueue[currentIndex].en, 'en-US');
        }
    });
</script>

</body>
</html>


